<!DOCTYPE html>
<html>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
      <a id="top"></a>
      <meta charset="utf-8">
      <meta name="viewport" 
          content="width=device-width, initial-scale=1.0">
      <title>My site</title>
      <link rel="stylesheet" href="/styles/style.css">  

      <link rel="stylesheet" href="/css/syntax.css">
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)']]                  
    }
  };
</script>

  </head>
  <body><div class="nav-div">
  <nav>
        <a href="http://localhost:1313/" class="">Home</a>
        <a href="http://localhost:1313/articles/" class="active">Articles</a>
        <a href="http://localhost:1313/paper-summary/" class="">Paper-Summaries</a>
        <a href="http://localhost:1313/tags/" class="">Tags</a>
        <a href="http://localhost:1313/poetry/" class="">Writings</a>
        <a href="http://localhost:1313/tangled_thoughts/" class="">Tangled-Thoughts</a>
        <a href="http://localhost:1313/media/" class="">Media</a>
        <a href="http://localhost:1313/links/" class="">Links</a>
        <a href="http://localhost:1313/about/" class="">About</a>
  </nav>
</div>
<div id="content">
<div class="article-content"> 
  <h1> My Homelab Part 11: Backup </h1>
  <p class="pub-date">Published: January 27, 2024</p>
  
  <p>It goes without saying that backups are crucial. If you aim to preserve your data for the future, proper backup practices are a necessity. The golden rule of backing up is the 3-2-1 rule, which advises having three copies of your data, on two different media, with one copy off-site.</p>
<p>In my case, I needed a backup solution for various types of data:</p>
<ul>
<li><strong>Photos</strong>: Currently stored on my phone.</li>
<li><strong>Text files</strong>: Including university notes, general notes, and articles, currently saved on my computers.</li>
<li><strong>Configuration files</strong>: From my server, currently saved on the SD card of the server.</li>
</ul>
<p>For my backup needs, I opted for two solutions: <strong>Syncthing</strong> and <strong>rsync</strong>.</p>
<p><strong>Syncthing</strong>:
You may already be familiar with Syncthing from my previous post in the Homelab Series, where I introduced it for data synchronization. However, it can also serve as a backup tool. By synchronizing every Syncthing folder I use with my server, I automatically create a copy on my server. Specifically, I configured Syncthing so that all synchronized data (such as photos and writings) is stored on the first external disk of the server.</p>
<p><strong>Rsync</strong>:
Given that my Raspberry Pi server uses an SD card for main storage, where the operating system and home folder are stored, I use rsync to back up my home folder to the first external disk. Rsync allows for folder-level backups, crucial in server environments where SD cards are prone to breaking under constant stress.</p>
<p>Using only one disk introduces the risk of disk failure. To mitigate this, I employ an additional disk to back up my first disk, again utilizing rsync for this task.</p>
<p>Although I considered using a RAID system, I decided against it for two reasons:</p>
<ol>
<li><strong>Lack of RAID Controller</strong>: I don&rsquo;t have a RAID controller and didn&rsquo;t want to invest in one. Using a RAID controller on the software level tends to be slower.</li>
<li><strong>Scale and Need:</strong> RAID isn&rsquo;t very effective at the scale of two disks, and I didn&rsquo;t require additional backup storage at the moment.</li>
</ol>
<p>For information on installing Syncthing, refer to my earlier post in this series, &ldquo;My Homelab Part 6: Syncthing.&rdquo;</p>
<h2 id="rsync">Rsync</h2>
<p><a href="https://linux.die.net/man/1/rsync">Rsync</a> is a command-line tool that should already be pre-installed on most Linux operating systems. To initiate a folder clone, use the command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="ln">1</span><span class="cl">rsync -r /origin/ /target
</span></span></code></pre></div><p>Keep in mind that rsync is slower than a simple move or clone command because it checks every file. For the initial backup, it&rsquo;s recommended to use the cloning command.</p>
<p>To regularly back up my home folder, I use cron(see &ldquo;My Homelab Part 0: Prologue&rdquo;), which allows me to schedule commands. To do that, start crontab with:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="ln">1</span><span class="cl">crontab -e
</span></span></code></pre></div><p>Here&rsquo;s an example of scheduling:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="ln">1</span><span class="cl"><span class="m">0</span> <span class="m">4</span> * * * rsync -aAXvh /mnt/externalDisk/ /mnt/externalBackupDisk/BackupDisk/
</span></span><span class="line"><span class="ln">2</span><span class="cl"><span class="m">0</span> <span class="m">2</span> * * * rsync -aAXvh /root /mnt/externalBackupDisk/BackupHome/
</span></span></code></pre></div><p>You can customize the scheduling as needed. In my case, I back up my home folder at 02:00 every day and my disk at 04:00. The meaning of the arguments can be <a href="https://linux.die.net/man/1/rsync">read here</a>, but to summarize briefly:</p>
<ul>
<li><code>a</code>: Archive option, indicating recursion and keeping everything.</li>
<li><code>A</code>: Updates the permission of the files.</li>
<li><code>X</code>: Removes extended attributes of files.</li>
<li><code>v</code>: Increases the amount of information given during transfer.</li>
<li><code>h</code>: Outputs numbers in a human-readable format.</li>
</ul>
<p>That&rsquo;s it, and always remember, backups are crucial.</p>


<figure style="display: block; margin-left: auto; margin-right: auto; width:80%; text-align:center">
    <img src="/attachments/backups.png">
    <figcaption style="text-align:center"><a href="https://xkcd.com/1718/">Source</a></figcaption>
</figure>


<h2 id="off-site-backups">Off-Site Backups</h2>
<p>In the beginning I talked about the 3-2-1 backup rule, one part of this is to have a backup offsite. Which I didn&rsquo;t quite address in this post, one way to achieve that is by placing your server not inside the house you live, this could be in the home of your parents or a friend. Another way could be to rent a server, and use synthing again there to sync your data between your rented server and your home server.</p>
 
</div>
<a href="#top" class="back-to-top-button">
  &#9650; 
</a>

    </div><div class="footer">
  Made with <a href="https://gohugo.io/">Hugo</a>, website licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>.
</div>
</body>
</html>
