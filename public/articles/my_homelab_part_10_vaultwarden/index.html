<!DOCTYPE html>
<html>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
      
      <a id="top"></a>
      <meta charset="utf-8">
      <meta name="viewport" 
          content="width=device-width, initial-scale=1.0">
      <title>My site</title>
      <link rel="stylesheet" href="/styles/style.css">  

      <link rel="stylesheet" href="/css/syntax.css">
      <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<script>
  MathJax = {
    tex: {
      displayMath: [['\\[', '\\]'], ['$$', '$$']],  
      inlineMath: [['\\(', '\\)']]                  
    }
  };
</script>

  </head>
  <body><div class="nav-div">
  <nav>
        <a href="http://localhost:1313/" class="">Home</a>
        <a href="http://localhost:1313/articles/" class="active">Articles</a>
        <a href="http://localhost:1313/paper-summary/" class="">Paper-Summaries</a>
        <a href="http://localhost:1313/tags/" class="">Tags</a>
        <a href="http://localhost:1313/poetry/" class="">Writings</a>
        <a href="http://localhost:1313/tangled_thoughts/" class="">Tangled-Thoughts</a>
        <a href="http://localhost:1313/media/" class="">Media</a>
        <a href="http://localhost:1313/links/" class="">Links</a>
        <a href="http://localhost:1313/about/" class="">About</a>
  </nav>
</div>
<div id="content">
<div class="article-content"> 
  <h1> My Homelab Part 10: Vaultwarden </h1>
  <p class="pub-date">Published: January 25, 2024</p>
  
  <p>Vaultwarden is an unofficial implementation of the Bitwarden password manager. One of its primary advantages is its lower resource intensity for hosting compared to the official implementation, along with the support of a robust community.</p>


<figure>
    <img style="display: block; margin-left: auto; margin-right: auto; width:100%" src="/attachments/8ddd4488bb9c1a355dc41d6b6db4898f.png">
    <figcaption>Vaultwarden Website.</figcaption>
</figure>


<p>Before adopting Vaultwarden, I relied on the offline password manager KeePassXC. However, it posed challenges with synchronization across multiple devices. For instance, if I altered a password on my phone, I had to transfer the entire password database to my computer to ensure synchronization. In contrast, Vaultwarden streamlines this process by automatically synchronizing password changes across all devices.</p>
<p>Here&rsquo;s how Vaultwarden operates: the Vaultwarden software is hosted on your server, managing and storing your passwords. Clients can access these passwords by connecting directly to your hosted Vaultwarden website, through the official Bitwarden browser extension, or via the Bitwarden app on a mobile device.</p>


<figure>
    <img style="display: block; margin-left: auto; margin-right: auto; width:80%" src="/attachments/Untitled%20Diagram.drawio.png">
    <figcaption>Explanation of Vaultwarden.</figcaption>
</figure>


<h2 id="installation">Installation</h2>
<p>As with my previous blog posts, I&rsquo;ll use Docker Compose to install Vaultwarden, employing the following Docker Compose file(vaultwarden-compose.yml):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 2</span><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 3</span><span class="cl"><span class="w">  </span><span class="nt">vaultwarden</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 4</span><span class="cl"><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l">vaultwarden</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 5</span><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">vaultwarden/server:latest</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 6</span><span class="cl"><span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l">unless-stopped</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 7</span><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 8</span><span class="cl"><span class="w">      </span>- <span class="l">/mnt/externalDisk/vaultwarden/:/data/</span><span class="w">
</span></span></span><span class="line"><span class="ln"> 9</span><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">10</span><span class="cl"><span class="w">      </span>- <span class="m">150</span><span class="p">:</span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="w">      </span>- <span class="l">DOMAIN=</span><span class="w">
</span></span></span><span class="line"><span class="ln">13</span><span class="cl"><span class="w">      </span>- <span class="l">WEB_VAULT_ENABLED=true</span><span class="w">
</span></span></span><span class="line"><span class="ln">14</span><span class="cl"><span class="w">      </span>- <span class="l">ADMIN_TOKEN=XXXXX</span><span class="w">
</span></span></span><span class="line"><span class="ln">15</span><span class="cl"><span class="w">      </span>- <span class="l">SIGNUPS_ALLOWED=false</span><span class="w">
</span></span></span><span class="line"><span class="ln">16</span><span class="cl"><span class="w">      </span>- <span class="l">EMERGENCY_ACCESS_ALLOWED=true</span><span class="w">
</span></span></span></code></pre></div><p>It&rsquo;s crucial to note that Vaultwarden deals with sensitive information, requiring a secure connection (HTTPS). In a non-secure connection (HTTP), accessing your password vault won&rsquo;t be possible. Therefore, I highly recommend following my previous blog post, where I demonstrated how to assign a domain to your internal services for secure internet access. If you&rsquo;ve followed that guide, remember to update your Caddyfile for this new service:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">vaultwarden.{$DOMAIN} {
</span></span><span class="line"><span class="ln">2</span><span class="cl">    import tls
</span></span><span class="line"><span class="ln">3</span><span class="cl">    import header
</span></span><span class="line"><span class="ln">4</span><span class="cl">    
</span></span><span class="line"><span class="ln">5</span><span class="cl">    reverse_proxy localhost:{$VAULTWARDEN_PORT}
</span></span><span class="line"><span class="ln">6</span><span class="cl">}
</span></span></code></pre></div><p>Additionally, starting from version <code>1.28</code> of Vaultwarden, the admin token must be <a href="https://github.com/dani-garcia/vaultwarden/wiki/Enabling-admin-page">hashed</a>. To do that, follow these steps:</p>
<ol>
<li>
<p>Execute the command <code>docker run --rm -it vaultwarden/server /vaultwarden hash</code> to initiate a temporary Vaultwarden instance for hashing your password.</p>
</li>
<li>
<p>Enter your desired password when prompted.</p>
</li>
<li>
<p>After receiving the password hash, escape the dollar sign using the command:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="ln">1</span><span class="cl">echo &#34;your_password&#34; | sed &#39;s#\$#\$\$#g&#39;
</span></span></code></pre></div></li>
<li>
<p>Copy the password hash and insert it into your Docker Compose file.</p>
</li>
</ol>
<p>To install Vaultwarden, proceed with these steps:</p>
<ol>
<li>
<p>For the initial run, set <code>SIGNUPS_ALLOWED</code> to <code>true</code> to create an account. After registration, stop the Vaultwarden container and set this variable to <code>false</code>.</p>
</li>
<li>
<p>Don&rsquo;t forget to set the <code>DOMAIN</code> in the Docker Compose file to your domain.</p>
</li>
<li>
<p>After configuring these variables, start your container using:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="ln">1</span><span class="cl">docker compose -f vaultwarden-compose.yml up -d
</span></span></code></pre></div></li>
<li>
<p>After a while, access your Vaultwarden service at <code>https://vaultwarden.Your_Domain</code>, displaying a page similar to this:<br>


    <figure>
        <img style="display: block; margin-left: auto; margin-right: auto; width:80%" src="/attachments/Screenshot%20from%202024-01-20%2012-42-41.png">
    </figure>
    
</p>
</li>
<li>
<p>Click &ldquo;Create account,&rdquo; leading to the registration page:<br>


    <figure>
        <img style="display: block; margin-left: auto; margin-right: auto; width:80%" src="/attachments/Screenshot%20from%202024-01-20%2012-43-28.png">
    </figure>
    
</p>
</li>
<li>
<p>After registration, stop the Vaultwarden container, disable sign ups, and restart the container using the following commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="ln">1</span><span class="cl">docker ps -a
</span></span><span class="line"><span class="ln">2</span><span class="cl">docker stop vaultwarden_id
</span></span></code></pre></div></li>
<li>
<p>Upon restarting the container, you can log in with your registered account. To manage settings, including user accounts, access the admin page at <code>https://vaultwarden.Your_Domain/admin</code>, requiring your admin token as password.</p>
</li>
</ol>
<hr>
<p>References:</p>
<ul>
<li><a href="https://github.com/dani-garcia/vaultwarden">https://github.com/dani-garcia/vaultwarden</a></li>
</ul>
 
</div>
<a href="#top" class="back-to-top-button">
  &#9650; 
</a>

    </div><div class="footer">
  Made with <a href="https://gohugo.io/">Hugo</a>, website licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a>.
</div>
</body>
</html>
